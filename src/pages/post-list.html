<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>게시글 목록 조회</title>
    <link rel="stylesheet" href="/src/pages/styles/post-list.css"/>
    <link rel="stylesheet" href="/src/pages/styles/header.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
</head>
<body>
<div id="header"></div>
<div class="board-container">
    <div class="board-container">
        <p class="board-title">
            안녕하세요, 강아지를 소개하며 소통하는<br><strong>PUPPYNESS 게시판</strong> 입니다.
        </p>
        <div class="board-header">
            <div class="write-wrapper">
                <img src="/src/assets/write.svg" alt="write">
                <div class="write-btn" onclick="location.href = `http://localhost:3000/src/pages/post-create.html`">
                    게시글 작성
                </div>
            </div>
        </div>

<!--        <div class="board-header">-->
<!--            <div class="write-wrapper">-->
<!--                <img src="/src/assets/write.svg" alt="write">-->
<!--                <button class="write-btn" onclick="location.href = `http://localhost:3000/src/pages/post-create.html`">-->
<!--                    게시글 작성-->
<!--                </button>-->
<!--            </div>-->
<!--        </div>-->
    </div>

    <div id="post-card-list"></div>
    <div id="observer"></div>
</div>

<script type="module">
    import api from "../utils/Api.js";
    import { PostCard } from "../components/PostCard.js";
    import { Dropdown } from "../utils/Dropdown.js";

    const observer = new IntersectionObserver((entries) => {
       if (entries[0].intersectionRatio <= 0) return;

       getPostList(10);
    });
    observer.observe(document.getElementById("observer"));

    let lastPostId = 0;

    const getPostList = async (limit) => {
        const path = lastPostId === 0 ?
            `/posts?limit=${limit}` :
            `/posts?limit=${limit}&lastPostId=${lastPostId}`;

        const postList = await api.get(path)
            .then((res) => res.json())
            .then((json) => json.data);

        console.log(postList);

        if (postList.length === 0) {
            observer.disconnect();
        }

        lastPostId = postList[postList.length - 1].id;
        const postCardListHtml = postList
            .map(post => PostCard(post))
            .join("");

        document.getElementById("post-card-list").innerHTML += postCardListHtml
    }

    fetch("/src/components/header.html")
        .then(res => res.text())
        .then(data => {
            document.getElementById("header").innerHTML = data;
            Dropdown();
        });
</script>
</body>
</html>